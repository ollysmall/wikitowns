{% extends 'website/base.html' %}

{% load static %}

{% load noobhub_filters %}

{% block title %}noobhub - comments {% endblock %}

{% block body_block %}

<div class="container bottom-padding">

<div class="card card-top-buffer card-link-text rec-shadow">

  <div class="card-block">
    <a href="{{ website.url }}" style="color: black;">
    <h4 class="card-title">{{ website.title }}</h4>
    </a>
    <p class="card-text">{{ website.description }}</p>
    <p></p>
    <p class="card-text">
      <a href="{% url 'user_profile' website.website_author %}" style="color: black;">
        <small class="text-muted">{{ website.website_author }} - {{ website.created_date|timesince|upto:',' }} ago</small>
      </a>
      {% if user.is_authenticated %}
      {% if website.website_author.pk == user.pk %}
        <a class="btn btn-outline-danger btn-sm pull-right" href="{% url 'delete_website' website.pk %}">Delete</a>
      {% endif %}
      {% endif %}

    </p>
  </div>

  <div class="card-footer text-muted">
    {% if user in website.upvote.all %}
      <i class="fa fa-arrow-up upvote_website clicked-button" data-websiteid="{{ website.id }}" aria-hidden="true"></i>
    {% else %}
      <i class="fa fa-arrow-up upvote_website" data-websiteid="{{ website.id }}" aria-hidden="true"></i>
    {% endif %}

    <small class="vote_total" data-websiteid="{{ website.id }}">{{ website.total_votes }}&nbsp;</small>

    {% if user in website.downvote.all %}
    <i class="fa fa-arrow-down downvote_website clicked-button" data-websiteid="{{ website.id }}" aria-hidden="true"></i>
    {% else %}
    <i class="fa fa-arrow-down downvote_website" data-websiteid="{{ website.id }}" aria-hidden="true"></i>
    {% endif %}

    {% if user in website.bookmark.all %}
    <i class="fa fa-bookmark-o pull-right bookmark_website clicked-button" data-websiteid="{{ website.id }}" aria-hidden="true"></i>
    {% else %}
    <i class="fa fa-bookmark-o pull-right bookmark_website" data-websiteid="{{ website.id }}" aria-hidden="true"></i>
    {% endif %}

    {% if website.comments.count > 0 %}
      <small class="pull-right">{{ website.comments.count }}&nbsp;</small>
    {% endif %}

    <a href="{% url 'website_comment' category.slug subcategory.slug website.pk %}" class="text-muted">
      <i class="fa fa-commenting-o pull-right" aria-hidden="true">&nbsp;</i>
    </a>



  </div>

</div>

<div class="card card-top-buffer rec-shadow">
  <div class="card-block">

    {% if user.is_authenticated %}
    <div class="bottom-padding">
      <form enctype="multipart/form-data" id="WebsiteCommentForm" method="post">
        {% csrf_token %}
        {{ form.as_p }}
        <input class="btn btn-primary btn-sm pull-right" type="submit" name="submit" value="Post" />
      </form>
    </div>
    {% endif %}

<strong>Comments</strong>

{% if comments %}

  {% for comment in comments %}
    <hr>
    <div class="card-text">
      <a href="{% url 'user_profile' comment.author %}">
      <strong>{{ comment.author }}</strong></a>
      &nbsp; {{ comment.text }}
      <p><small class="text-muted">{{ comment.created_date|timesince|upto:',' }} ago</small></p>
      {% if user.is_authenticated %}
      {% if comment.author.pk == user.pk %}
        <p><a class="btn btn-outline-danger btn-sm " href="{% url 'delete_website_comment' comment.pk %}">Delete</a>
          <a class="btn btn-outline-danger btn-sm " href="{% url 'edit_website_comment' comment.pk %}">Edit</a>
        </p>
      {% endif %}
      {% endif %}
    </div>



  {% endfor %}
{% else %}
<hr>
<small>No comments have been made yet.</small>
{% endif %}

</div>
</div>

</div>

{% endblock %}
